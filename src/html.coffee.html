<!DOCTYPE html>
<html>
<head>
  <title>html.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "src/html.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#report-generation">Report generation</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#configuration">Configuration</a>
      </div>

      <div class="heading h2">
        <a href="#convert-into-html">Convert into HTML</a>
      </div>

      <div class="heading h2">
        <a href="#frame-html-content-with-lib-adding">Frame HTML content with lib adding</a>
      </div>

      <div class="heading h2">
        <a href="#helper-methods">Helper methods</a>
      </div>

      <div class="heading h3">
        <a href="#initialize-markdown-to-html-converter">initialize markdown to html converter</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-report" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="report-generation">
  <h1>
    <a href="#report-generation" name="report-generation" class="pilcrow"></a>
Report generation
  </h1>
</div>
<p>This package will give you an easy and robust way to access mysql databases.</p>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">path = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span>
mime = <span class="hljs-built_in">require</span> <span class="hljs-string">'mime'</span>
inlineCss = <span class="hljs-built_in">require</span> <span class="hljs-string">'inline-css'</span>
fs = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-fs'</span>
util = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-util'</span>
CleanCSS = <span class="hljs-built_in">require</span> <span class="hljs-string">'clean-css'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>markdown</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">markdownit = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it'</span>
hljs = <span class="hljs-built_in">require</span> <span class="hljs-string">'highlight.js'</span>
mdContainer = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-container'</span>
mdTitle = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-title'</span> <span class="hljs-comment">#extracting title from source (first heading)</span>
mdSub = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-sub'</span> <span class="hljs-comment"># subscript support</span>
mdSup = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-sup'</span> <span class="hljs-comment"># superscript support</span>
mdMark = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-mark'</span> <span class="hljs-comment"># add text as "marked"</span>
mdEmoji = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-emoji'</span> <span class="hljs-comment"># add graphical emojis</span>
mdDeflist = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-deflist'</span> <span class="hljs-comment"># definition lists</span>
mdAbbr = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-abbr'</span> <span class="hljs-comment"># abbreviations (auto added)</span>
mdFootnote = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-footnote'</span> <span class="hljs-comment"># footnotes (auto linked)</span>
mdCheckbox = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-checkbox'</span>
mdDecorate = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-decorate'</span> <span class="hljs-comment"># add css classes</span>
mdToc = <span class="hljs-built_in">require</span> <span class="hljs-string">'markdown-it-toc-and-anchor'</span>
twemoji = <span class="hljs-built_in">require</span> <span class="hljs-string">'twemoji'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>load own plugins</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">pluginExecute = <span class="hljs-built_in">require</span> <span class="hljs-string">'./plugin/execute'</span>
pluginFontawesome = <span class="hljs-built_in">require</span> <span class="hljs-string">'./plugin/fontawesome'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="configuration">
  <h2>
    <a href="#configuration" name="configuration" class="pilcrow"></a>
Configuration
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">HTML_STYLES =
  default: <span class="hljs-string">"<span class="hljs-subst">#{__dirname}</span>/../var/src/style/default.css"</span>

trans =
  content:
    en: <span class="hljs-string">'Content'</span>
    de: <span class="hljs-string">'Inhalt'</span>
  lang:
    bash:
      en: <span class="hljs-string">'Bash Script Code'</span>
    coffee:
      en: <span class="hljs-string">'CoffeeScript Code'</span>
    js:
      en: <span class="hljs-string">'JavaScript Code'</span>
    sh:
      en: <span class="hljs-string">'Shell Script Code'</span>
    sql:
      en: <span class="hljs-string">'SQL Code'</span>
    handlebars:
      en: <span class="hljs-string">'Handlebars template'</span>
    json:
      en: <span class="hljs-string">'JSON Data'</span>
    yaml:
      en: <span class="hljs-string">'YAML Data'</span>
    markdown:
      en: <span class="hljs-string">'Markdown Document'</span>
  boxes:
    info:
      en: <span class="hljs-string">'Info'</span>
    warning:
      en: <span class="hljs-string">'Warning'</span>
      de: <span class="hljs-string">'Warnung'</span>
    alert:
      en: <span class="hljs-string">'Attention'</span>
      de: <span class="hljs-string">'Achtung'</span>

VERSION = <span class="hljs-literal">null</span> <span class="hljs-comment"># will be set on init</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="convert-into-html">
  <h2>
    <a href="#convert-into-html" name="convert-into-html" class="pilcrow"></a>
Convert into HTML
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">(report, setup = {}, cb)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> setup <span class="hljs-keyword">is</span> <span class="hljs-string">'function'</span>
    cb = setup
    setup = {}</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>create html</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  md = initHtml()
  content = report.toString()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>make local files inline
replace local images with base64</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  content = content.replace <span class="hljs-regexp">///
    (                 <span class="hljs-comment"># before:</span>
      !\[.*?\]        <span class="hljs-comment">#   image alt text</span>
      \(              <span class="hljs-comment">#   opening url</span>
    )file://(         <span class="hljs-comment"># file:</span>
      [^ ]*?          <span class="hljs-comment">#   image source</span>
    )(                <span class="hljs-comment"># after:</span>
      (?: ".*?")?     <span class="hljs-comment">#   title text</span>
      \)              <span class="hljs-comment">#   closing url</span>
    )
    ///</span>, <span class="hljs-function"><span class="hljs-params">(_, b, f, a)</span> -&gt;</span>
    f = path.resolve __dirname, <span class="hljs-string">'../'</span>, f
    bin = <span class="hljs-keyword">new</span> Buffer(fs.readFileSync f).toString <span class="hljs-string">'base64'</span>
    <span class="hljs-string">"<span class="hljs-subst">#{b}</span>data:<span class="hljs-subst">#{mime.lookup f}</span>;base64,<span class="hljs-subst">#{bin}</span><span class="hljs-subst">#{a}</span>"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>transform to html</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  data = util.clone setup
  innerHtml = md.render content, data
  content = optimizeHtml innerHtml, setup?.locale
  title = setup?.title ? data.title ? <span class="hljs-string">'Report'</span>
  tags = util.clone report.parts.header
  js = data.js?.join <span class="hljs-string">'\n'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>add used libraries
code highlighting</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> content.match <span class="hljs-regexp">/\sclass="hljs-/</span>
    tags.unshift <span class="hljs-string">"""&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/\
      highlight.js/8.5.0/styles/solarized_light.min.css" /&gt;"""</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>font awesome</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> content.match <span class="hljs-regexp">/\sclass="fa\s/</span>
    tags.unshift <span class="hljs-string">"""&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/\
      font-awesome/4.6.3/css/font-awesome.min.css" /&gt;"""</span>
  <span class="hljs-keyword">unless</span> setup.noJS
    addLibs tags, js</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>complete html</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  html = <span class="hljs-string">"""
  &lt;!DOCTYPE html&gt;
  &lt;html lang="<span class="hljs-subst">#{<span class="hljs-keyword">if</span> setup?.locale <span class="hljs-keyword">then</span> setup.locale[<span class="hljs-number">0.</span><span class="hljs-number">.1</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">'en'</span>}</span>"&gt;
    &lt;head&gt;
      &lt;title&gt;<span class="hljs-subst">#{title}</span>&lt;/title&gt;
      &lt;meta charset="UTF-8" /&gt;
  """</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>add page style with collected css</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  style = setup?.style ? <span class="hljs-string">'default'</span>
  css = data.css?.join(<span class="hljs-string">'\n'</span>) ? <span class="hljs-string">''</span>
  <span class="hljs-keyword">if</span> css
    css = <span class="hljs-keyword">new</span> CleanCSS().minify(css).styles
    css = <span class="hljs-string">"""&lt;style type="text/css"&gt;<span class="hljs-subst">#{css}</span>&lt;/style&gt;"""</span>
  html += <span class="hljs-keyword">switch</span>
    <span class="hljs-keyword">when</span> style <span class="hljs-keyword">in</span> Object.keys HTML_STYLES
      <span class="hljs-string">"""&lt;link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/alinex/node-report/\
      v<span class="hljs-subst">#{VERSION}</span>/var/src/style/<span class="hljs-subst">#{path.basename HTML_STYLES[style]}</span>" /&gt;<span class="hljs-subst">#{css}</span>"""</span>
    <span class="hljs-keyword">when</span> style.match <span class="hljs-regexp">/^https?:\/\//</span>
      <span class="hljs-string">"""&lt;link rel="stylesheet" href="<span class="hljs-subst">#{style}</span>" /&gt;<span class="hljs-subst">#{css}</span>"""</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-string">"""&lt;style type="text/css"&gt;
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>{fs.readFileSync style, 'utf8'}#{css}</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      &lt;/style&gt;<span class="hljs-string">"""
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>add defined tags</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> tags.length
    html += util.array.unique(tags).join <span class="hljs-string">'\n'</span>
  <span class="hljs-keyword">if</span> js?.match <span class="hljs-regexp">/mermaid\.initialize/</span>
    html += <span class="hljs-string">"""&lt;style type="text/css"&gt;div#page {display:block}&lt;/style&gt;"""</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>add body</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  html += <span class="hljs-string">"""
    &lt;/head&gt;
    &lt;body&gt;&lt;div id="page"&gt;<span class="hljs-subst">#{content}</span>&lt;/div&gt;&lt;/body&gt;
  &lt;/html&gt;
  """</span>
  <span class="hljs-keyword">return</span> html <span class="hljs-keyword">unless</span> cb
  <span class="hljs-keyword">return</span> cb <span class="hljs-literal">null</span>, html <span class="hljs-keyword">unless</span> setup?.inlineCss</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>make css inline</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  inlineCss html,
    url: <span class="hljs-string">'index.html'</span>
  .<span class="hljs-keyword">then</span> (html) -&gt;
    cb <span class="hljs-literal">null</span>, html</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="frame-html-content-with-lib-adding">
  <h2>
    <a href="#frame-html-content-with-lib-adding" name="frame-html-content-with-lib-adding" class="pilcrow"></a>
Frame HTML content with lib adding
  </h2>
</div>
<p>Method for html+js to image conversion</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-built_in">module</span>.exports.frame = <span class="hljs-function"><span class="hljs-params">(html, js, check)</span> -&gt;</span>
  tags = []
  addLibs tags, <span class="hljs-string">"<span class="hljs-subst">#{js}</span>\n<span class="hljs-subst">#{check}</span>"</span>
  js = <span class="hljs-keyword">unless</span> js <span class="hljs-keyword">then</span> <span class="hljs-string">''</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"""&lt;script type="text/javascript"&gt;&lt;!--\n<span class="hljs-subst">#{js}</span>\n//--&gt;&lt;/script&gt;"""</span>
  <span class="hljs-string">"""
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
    &lt;head&gt;
      &lt;meta charset="UTF-8" /&gt;
      &lt;link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/alinex/node-report/\
      v<span class="hljs-subst">#{VERSION}</span>/var/src/style/<span class="hljs-subst">#{path.basename HTML_STYLES[<span class="hljs-string">'default'</span>]}</span>" /&gt;
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>{tags.join '\n'}
{js}</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    &lt;/head&gt;
    &lt;body&gt;&lt;div id=<span class="hljs-string">"page"</span>&gt;<span class="hljs-comment">#{html}&lt;/div&gt;&lt;/body&gt;</span>
  &lt;/html&gt;
  <span class="hljs-string">"""


</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="helper-methods">
  <h2>
    <a href="#helper-methods" name="helper-methods" class="pilcrow"></a>
Helper methods
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">addLibs</span> = <span class="hljs-params">(tags, js)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>optimized tables</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> js?.match <span class="hljs-regexp">/\.DataTable\(/</span>
    tags.unshift <span class="hljs-string">"""
      &lt;link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/\
      1.10.12/css/jquery.dataTables.css" /&gt;"""</span>
    tags.push <span class="hljs-string">"""
      &lt;script type="text/javascript" src="https://code.jquery.com/\
      jquery-1.12.3.js"&gt;&lt;/script&gt;"""</span>
    tags.push <span class="hljs-string">"""
      &lt;script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/\
      1.10.12/js/jquery.dataTables.js"&gt;&lt;/script&gt;"""</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>ad jui chart libs</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> js?.match <span class="hljs-regexp">/jui\./</span>
    tags.push <span class="hljs-string">"""
      &lt;script type="text/javascript" src="https://code.jquery.com/\
      jquery-1.12.3.js"&gt;&lt;/script&gt;"""</span>
    tags.push <span class="hljs-string">"""&lt;script src="https://cdn.rawgit.com/juijs/jui-chart/\
      v2.0.4/lib/core.min.js"&gt;&lt;/script&gt;"""</span>
    tags.push <span class="hljs-string">"""&lt;script src="https://cdn.rawgit.com/juijs/jui-chart/\
      v2.0.4/dist/chart.min.js"&gt;&lt;/script&gt;"""</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>add only jquery</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> js?.match <span class="hljs-regexp">/\$\(/</span>
    tags.push <span class="hljs-string">"""
      &lt;script type="text/javascript" src="https://code.jquery.com/\
      jquery-1.12.3.js"&gt;&lt;/script&gt;"""</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>mermaid</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> js?.match <span class="hljs-regexp">/mermaid\.initialize/</span>
    tags.push <span class="hljs-string">"""
      &lt;script type="text/javascript" src="https://code.jquery.com/\
      jquery-1.12.3.js"&gt;&lt;/script&gt;"""</span>
    tags.push <span class="hljs-string">"""
      &lt;script type="text/javascript" src="https://cdn.rawgit.com/knsv/mermaid/\
      6.0.0/dist/mermaidAPI.min.js"&gt;&lt;/script&gt;"""</span>
    tags.push <span class="hljs-string">"""
      &lt;link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/knsv/mermaid/\
      6.0.0/dist/mermaid.forest.css" /&gt;"""</span>
    tags.push <span class="hljs-string">"""
      &lt;script type="text/javascript"&gt;mermaidAPI.initialize({startOnLoad:true});&lt;/script&gt;"""</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="initialize-markdown-to-html-converter">
  <h3>
    <a href="#initialize-markdown-to-html-converter" name="initialize-markdown-to-html-converter" class="pilcrow"></a>
initialize markdown to html converter
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">md2html = <span class="hljs-literal">null</span>
<span class="hljs-function"><span class="hljs-title">initHtml</span> = -&gt;</span> <span class="hljs-comment">#async.once -&gt;</span>
  <span class="hljs-keyword">return</span> md2html <span class="hljs-keyword">if</span> md2html</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>get report version</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  pack = JSON.parse fs.readFileSync <span class="hljs-string">"<span class="hljs-subst">#{path.dirname __dirname}</span>/package.json"</span>, <span class="hljs-string">'utf8'</span>
  VERSION = pack.version</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>setup markdown it</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  md2html = markdownit
    html: <span class="hljs-literal">true</span>
    linkify: <span class="hljs-literal">true</span>
    typographer: <span class="hljs-literal">true</span>
    xhtmlOut: <span class="hljs-literal">true</span>
    langPrefix: <span class="hljs-string">'language '</span>
    highlight: <span class="hljs-function"><span class="hljs-params">(str, lang)</span> -&gt;</span>
      <span class="hljs-keyword">if</span> lang <span class="hljs-keyword">and</span> hljs.getLanguage lang
        <span class="hljs-keyword">try</span>
          <span class="hljs-keyword">return</span> hljs.highlight(lang, str).value
      <span class="hljs-keyword">try</span>
        <span class="hljs-keyword">return</span> hljs.highlightAuto(str).value
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span> <span class="hljs-comment"># use external default escaping</span>
  .use pluginExecute <span class="hljs-comment"># graphical visualizations</span>
  .use mdTitle <span class="hljs-comment">#extracting title from source (first heading)</span>
  .use mdSub <span class="hljs-comment"># subscript support</span>
  .use mdSup <span class="hljs-comment"># superscript support</span>
  .use mdContainer, <span class="hljs-string">'detail'</span> <span class="hljs-comment"># special boxes</span>
  .use mdContainer, <span class="hljs-string">'info'</span> <span class="hljs-comment"># special boxes</span>
  .use mdContainer, <span class="hljs-string">'warning'</span> <span class="hljs-comment"># special boxes</span>
  .use mdContainer, <span class="hljs-string">'alert'</span> <span class="hljs-comment"># special boxes</span>
  .use mdMark <span class="hljs-comment"># add text as "marked"</span>
  .use mdEmoji <span class="hljs-comment"># add graphical emojis</span>
  .use pluginFontawesome
  .use mdDeflist <span class="hljs-comment"># definition lists</span>
  .use mdAbbr <span class="hljs-comment"># abbreviations (auto added)</span>
  .use mdFootnote <span class="hljs-comment"># footnotes (auto linked)</span>
  .use mdCheckbox, {divWrap: <span class="hljs-literal">true</span>, divClass: <span class="hljs-string">'cb'</span>}
  .use mdDecorate <span class="hljs-comment"># add css classes</span>
  .use mdToc.default, <span class="hljs-comment"># possibility to add TOC</span>
    tocClassName: <span class="hljs-string">'table-of-contents'</span>
    tocFirstLevel: <span class="hljs-number">2</span>
    anchorLink: <span class="hljs-literal">false</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>set base to allow also access from local page display</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  twemoji.base = <span class="hljs-string">'https://twemoji.maxcdn.com/'</span>
  md2html.renderer.rules.emoji = <span class="hljs-function"><span class="hljs-params">(token, idx)</span> -&gt;</span>
    twemoji.parse token[idx].content
  md2html
<span class="hljs-function">
<span class="hljs-title">text</span> = <span class="hljs-params">(tag, locale, tr = trans)</span> -&gt;</span>
  parts = tag.split <span class="hljs-regexp">/\./</span>
  <span class="hljs-keyword">return</span> text parts[<span class="hljs-number">1.</span>.].join(<span class="hljs-string">'.'</span>), locale, tr[parts[<span class="hljs-number">0</span>]] <span class="hljs-keyword">unless</span> parts.length <span class="hljs-keyword">is</span> <span class="hljs-number">1</span>
  tr[tag][locale] ? tr[tag][locale[<span class="hljs-number">0.</span><span class="hljs-number">.1</span>]] ? tr[tag].en
<span class="hljs-function">
<span class="hljs-title">optimizeHtml</span> = <span class="hljs-params">(html, locale = <span class="hljs-string">'en'</span>)</span> -&gt;</span>
  re = [
    [
      <span class="hljs-regexp">/&lt;p&gt;\n(&lt;ul class="table-of-contents"&gt;)([\s\S]*?&lt;\/ul&gt;)\n&lt;\/p&gt;/g</span>
      <span class="hljs-string">"$1&lt;header&gt;<span class="hljs-subst">#{text <span class="hljs-string">'content'</span>, locale}</span>&lt;/header&gt;$2"</span>
    ]
  ]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>code</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">of</span> trans.lang
    re.push [
      <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">'(&lt;code class="language '</span> + tag + <span class="hljs-string">'"&gt;)'</span>, <span class="hljs-string">'g'</span>
      <span class="hljs-string">"$1&lt;header&gt;<span class="hljs-subst">#{text tag, locale, trans.lang}</span>&lt;/header&gt;"</span>
    ]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>boxes</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">of</span> trans.boxes
    re.push [
      <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">'(&lt;div class="'</span> + tag + <span class="hljs-string">'"&gt;)'</span>, <span class="hljs-string">'g'</span>
      <span class="hljs-string">"$1&lt;header&gt;<span class="hljs-subst">#{text tag, locale, trans.boxes}</span>&lt;/header&gt;"</span>
    ]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>replacement</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">for</span> [s, r] <span class="hljs-keyword">in</span> re
    html = html.replace s, r</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>return result</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  html</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
